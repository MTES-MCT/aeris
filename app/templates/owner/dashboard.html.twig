{% extends "common/base_inside.html.twig" %}


{% block body %}
  <section class="section">
    <div class="container">
      <h2>Dashboard</h2>
      <p>Bienvenue <strong>{{ app.user.username }} </strong></p>
        <ul>            
        {% if mainIncinerateur %}
            <li>
                <p><strong>{{ mainIncinerateur.name }}</strong>, possède
                {{ mainIncinerateur.nbLignes }} lignes</p>
                {% for ligne in mainIncinerateur.lignes %}
                  la ligne n°{{ ligne.numero }} a {{ ligne.nbFours }} fours<br/>
                {% endfor %}
            </li>
        {% else %}
            <p>Pas d'incinéraeur associé</p>
        {% endif %}
        </ul>

      <h1>TODO: ajout de graphes</h1>

    {% for ligne in mainIncinerateur.lignes %}
      <div style="width: 75%;">
        <canvas id="canvas_dioxine_{{ligne.numero}}"></canvas>
      </div>              

    {% endfor %}


<script src="{{ asset('build/app.js') }}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-annotation/0.5.5/chartjs-plugin-annotation.js"></script>
<script src="https://cdn.rawgit.com/chartjs/Chart.js/master/samples/utils.js"></script>

<script>
    var dashboardData = {{ output|json_encode()|raw }}
    
    window.onload = function() {
      var color = Chart.helpers.color;
      var barChartData = {
        labels: dashboardData.months,
        datasets: [{
          label: 'Ligne 1',
          backgroundColor: color('rgba(255, 99, 132, 0.2)').alpha(0.5).rgbString(),
          borderColor: 'rgba(255, 99, 132, 0.2)',
          borderWidth: 1,
          data: dashboardData.lines[1]
        }]

      };

      var ctx = document.getElementById('canvas_dioxine_1').getContext('2d');
      window.myBar = new Chart(ctx, {
        type: 'bar',
        data: barChartData,
        options: {
          responsive: true,
          legend: {
            position: 'top',
          },
          /*title: {
            display: true,
            text: 'Declarations de dioxines'
          },*/
          scales: {
              yAxes: [{
                  ticks: {
                      beginAtZero:true
                  }
              }]
          },
          annotation: {
            annotations: [
              {
                type: "line",
                mode: "horizontal",
                scaleID: "y-axis-0",
                value: 0.1,
                borderColor: "red",
                label: {
                  content: "Seuil : 0.1 ng/m^3",
                  enabled: true,
                  position: "top"
                }
              }
            ]
          }
        }
      });
    };

  </script>
    </div>
  </section>
{% endblock %}